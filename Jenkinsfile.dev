pipeline {
    agent any

    environment {
        name = 'demo-app'
        port = '8080:8080'
        ruta = 'D:/proyecto-spring/demo'
    }

    stages {
        stage('Construir imagen') {
            steps {
                script {
                    dir(ruta) {
                        // Utiliza la ruta completa de docker
                        bat "\"C:\\Program Files\\Docker\\Docker\\resources\\bin\\docker.exe\" build -t ${name} ."
                    }
                }
            }
        }

        stage('Docker images') {
            steps {
                script {
                    dir(ruta) {
                        // Utiliza la ruta completa de docker
                        bat '"C:\\Program Files\\Docker\\Docker\\resources\\bin\\docker.exe" images'
                    }
                }
            }
        }

        stage('Construir contenedor') {
            steps {
                script {
                    dir(ruta) {
                        // Ajusta el comando para Windows
                        bat "\"C:\\Program Files\\Docker\\Docker\\resources\\bin\\docker.exe\" run -d -p ${port} ${name}"
                    }
                }
            }
        }

        stage('Docker container') {
            steps {
                script {
                    // Utiliza la ruta completa de docker
                    bat '"C:\\Program Files\\Docker\\Docker\\resources\\bin\\docker.exe" ps'
                }
            }
        }

        stage('Test') {
            steps {
                echo 'Ã‰xito'
            }
        }
    }

    post {
        always {
            // Elimina el workspace al final del pipeline
            cleanWs()
        }
    }
}
